{% extends "modelo.html" %}

{% block conteudo %}

<header>
    <h1 class="fw-bold">Interaja com a IA (Gemini)</h1>
    <p class="lead">Digite sua pergunta e veja a resposta da Inteligência Artificial!</p>
</header>

<div class="container py-5">

    <div class="row justify-content-center">
        <div class="col-md-8">

            <!-- Card do Formulário -->
            <div class="card shadow p-4">
                <h4 class="fw-bold mb-3 text-primary">Pergunte algo:</h4>

                <!-- Formulário que envia via POST -->
                <form method="POST">
                    <div class="mb-3">
                        <label for="pergunta" class="form-label">Sua pergunta</label>
                        <textarea
                            id="pergunta"
                            name="pergunta"
                            class="form-control"
                            rows="4"
                            placeholder="Digite sua pergunta aqui..."
                            required></textarea>
                    </div>

                    <button class="btn btn-primary w-100 fw-bold">
                        Enviar Pergunta
                    </button>
                </form>
            </div>

            <!-- Área de Resposta da IA -->
            {% if response %}
            <div class="card shadow p-4 mt-4">
                <h4 class="fw-bold text-success">Resposta da IA:</h4>
                <div id="ai-response" class="mt-2">{{ response }}</div>
            </div>
            {% endif %}

        </div>
    </div>
</div>

<script>
(function() {
    try {
        const raw = {{ response|tojson|safe }} || '';
        const container = document.getElementById('ai-response');
        if (!container) return;

        let processed = String(raw || '');
        processed = processed.replace(/```(?:[a-zA-Z0-9_+-]*)\s*([\s\S]*?)\s*```/g, '$1').trim();

        function looksLikeHTML(str) {
            return /<[^>]+>/.test(str);
        }

        if (looksLikeHTML(processed)) {
            container.innerHTML = processed;
        } else {
            container.textContent = processed;
        }
    } catch (e) {
        console.error('Erro ao renderizar resposta da IA:', e);
        const container = document.getElementById('ai-response');
        if (container) container.textContent = String({{ response|tojson|safe }} || '');
    }
})();
</script>

{% endblock %}
